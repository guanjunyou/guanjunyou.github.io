<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        GJY的博客
    </title>
    <meta name="description" content= 关竣佑的博客 >
    <meta name="keywords" content= Blog,Hexo,GuanJunyou,关竣佑 >
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            迷宫逆向题总结
        </p>
        <hr>
    </div>
    <div class="post-content">
        <span id="more"></span>

<h2 id="CTF逆向入门：迷宫题学习记录"><a href="#CTF逆向入门：迷宫题学习记录" class="headerlink" title="**CTF逆向入门：迷宫题学习记录 **"></a>**CTF逆向入门：迷宫题学习记录 **</h2><p>**<br><font color=#999AAA ><br></font></p>
<h1 id="（前言）"><a href="#（前言）" class="headerlink" title="（前言）"></a>（前言）</h1><p><font color=#999AAA > 本文将不断更新以具体题目为载体，分析CTF逆向迷宫题的解题思路与方法。由于本人是新手，学识有限，若有错漏或不当之处，欢迎指出。</font></p>
<hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1">

<p>提示：以下是本篇文章正文内容，下面案例可供参考</p>
<h1 id="一、-逆向迷宫题概述"><a href="#一、-逆向迷宫题概述" class="headerlink" title="一、 逆向迷宫题概述"></a>一、 逆向迷宫题概述</h1><p> 迷宫题当然是走迷宫最后得到flag啦！<br>主要步骤：<br>1.分析程序的主函数，找到迷宫<br>2分析程序，确定走迷宫的方法（上下左右..怎么走）<br>3写程序或手走迷宫，得到flag</p>
<h1 id="二、-具体题目分析"><a href="#二、-具体题目分析" class="headerlink" title="二、 具体题目分析"></a>二、 具体题目分析</h1><h2 id="1-2019华南师大CTF新生赛maze"><a href="#1-2019华南师大CTF新生赛maze" class="headerlink" title="1. 2019华南师大CTF新生赛maze"></a>1. 2019华南师大CTF新生赛maze</h2><p>题目地址：<a target="_blank" rel="noopener" href="https://github.com/scnu-sloth/hsctf-2019-freshmen">https://github.com/scnu-sloth/hsctf-2019-freshmen</a><br><img src="https://img-blog.csdnimg.cn/20210202142109807.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,colorFFFFFF,t_70#pic_center" alt="在这里插入图片描述">在hex-view里看到了迷宫，下一步是找走迷宫的规则和方法<br>点开check函数看到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __cdecl <span class="title">check</span><span class="params">(<span class="keyword">char</span> *flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> *cur; <span class="comment">// [esp+Ch] [ebp-4h]170个字符，其中有一个是空字符&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">  cur = &amp;maze[<span class="number">14</span>];<span class="comment">//这是一个含14*12的迷宫</span></span><br><span class="line">  <span class="keyword">while</span> ( *flag &amp;&amp; *cur != <span class="string">&#x27;*&#x27;</span> )<span class="comment">//由此可见&#x27;*&#x27;是迷宫的墙</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = flag++;</span><br><span class="line">    v2 = *v1;</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="string">&#x27;d&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++cur;<span class="comment">//d为向右走一步</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v2 &gt; <span class="string">&#x27;d&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v2 == <span class="string">&#x27;s&#x27;</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        cur += <span class="number">13</span>;<span class="comment">//s为向右13步，在本二维数组中为向左下方一步或向右13步</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v2 != <span class="string">&#x27;w&#x27;</span> )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        cur -= <span class="number">13</span>;<span class="comment">//w为向右上方一步或向左13步</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v2 != <span class="string">&#x27;a&#x27;</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      --cur;<span class="comment">//a为向左一步</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> *cur == <span class="string">&#x27;#&#x27;</span>;<span class="comment">//&#x27;#&#x27;是迷宫终点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由题意，这是个14*12的迷宫，@是起点，#是终点，flag走迷宫的路径<br>d:向前一步，a:向后一步，s:向前13步，w:向后13步<br><img src="https://img-blog.csdnimg.cn/20210202145448753.png#pic_center" alt="在这里插入图片描述">由main函数可见，flag长度即走迷宫步数一共为24步<br>手画迷宫如下，X表示不可走，O表示可走<br>写代码生成迷宫</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s[]=<span class="string">&quot;**************@************-************-***-**-*****--*****-*****-***#**-*****--**----******-*****-******-****--******---**-*******-*-----******-------*****************&quot;</span>;</span><br><span class="line">	<span class="keyword">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">14</span>;j++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(s[i*<span class="number">14</span>+j]==<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;0&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(s[i*<span class="number">14</span>+j]==<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;X&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">				<span class="keyword">else</span> </span><br><span class="line">				cout&lt;&lt;s[i*<span class="number">14</span>+j]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		cout&lt;&lt;endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210202220104191.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">用BFS走迷宫（代码如下）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> mp[<span class="number">12</span>*<span class="number">15</span>];</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">12</span>*<span class="number">15</span>];</span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">13</span>,<span class="number">-13</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> S[<span class="number">4</span>]=&#123;<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;w&#x27;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line">	string s;</span><br><span class="line">&#125;;</span><br><span class="line">queue&lt;node&gt; Q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	node tmp;</span><br><span class="line">	tmp.x=<span class="number">15</span>;tmp.s=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	Q.<span class="built_in">push</span>(tmp);</span><br><span class="line">	<span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		node now=Q.<span class="built_in">front</span>();</span><br><span class="line">		Q.<span class="built_in">pop</span>();</span><br><span class="line">		vis[now.x]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(mp[now.x]==<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			cout&lt;&lt;<span class="string">&quot;flag&#123;&quot;</span>&lt;&lt;now.s&lt;&lt;<span class="string">&quot;&#125;&quot;</span>&lt;&lt;endl;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">4</span>;k++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> ux=now.x+dir[k];</span><br><span class="line">			<span class="keyword">if</span>(ux&lt;<span class="number">1</span>||ux&gt;<span class="number">168</span>||mp[ux]==<span class="string">&#x27;X&#x27;</span>||vis[ux]==<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">			tmp.x=ux;</span><br><span class="line">			tmp.s=now.s+S[k];</span><br><span class="line">			Q.<span class="built_in">push</span>(tmp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">12</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">14</span>;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			cin&gt;&gt;mp[++t];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line">	<span class="built_in">bfs</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果<br><img src="https://img-blog.csdnimg.cn/20210611100413538.png#pic_center" alt="在这里插入图片描述"></p>
<p> <strong>flag{sssssdsssddsdddwwdwwaaaw}</strong></p>
<h2 id="2-2020华南师大CTF新生赛maze"><a href="#2-2020华南师大CTF新生赛maze" class="headerlink" title="2.2020华南师大CTF新生赛maze"></a>2.2020华南师大CTF新生赛maze</h2><p>题目地址<a target="_blank" rel="noopener" href="https://github.com/scnu-sloth/hsctf-2020-freshmen">https://github.com/scnu-sloth/hsctf-2020-freshmen</a><br>拖进IDA反编译，查看main函数<br><img src="https://img-blog.csdnimg.cn/2021020508415067.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">flag长度限制为59,应该是迷宫的最短路径<br>并且发现了一个CreateMap函数，应该里面有关于迷宫的信息。点开来看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CreateMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [esp+4h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v2; <span class="comment">// [esp+Ah] [ebp-6h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = num[i];<span class="comment">//num数组有16个数</span></span><br><span class="line">    v1 = <span class="number">1</span>;<span class="comment">//v2是无符号整型</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">map</span>[<span class="number">16</span> * i + <span class="number">16</span> - v1] = v2 &amp; <span class="number">1</span>;<span class="comment">//map是二维数组，有256个数。</span></span><br><span class="line">      v2 &gt;&gt;= <span class="number">1</span>;<span class="comment">//相当于v2=v2/2^1</span></span><br><span class="line">      result = v1++;</span><br><span class="line">    &#125;<span class="comment">//这是转二进制</span></span><br><span class="line">    <span class="comment">//v2按位与1，提取二进制最后一位数，v2在除以2，意思是不断把</span></span><br><span class="line">    <span class="comment">//二进制每一位提取出来。相当于进制转换。</span></span><br><span class="line">    <span class="keyword">while</span> ( result &amp;&amp; v1 &lt;= <span class="number">16</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道迷宫题与众不同，要我们根据函数生成迷宫<br>该程序的意思是把num中的每个数转为无符号整型再<strong>转为二进制</strong>储存再map数组中。原本16个数字变成16*16=256个数字。根据题意该迷宫是个16X16迷宫。因此我们想要得到迷宫，<strong>必须知道循环中每个v2的值</strong>。我想到通过动态调试一一记录下16个v2的值（该方法要有耐心，肯定有更好的方法）<br>接下来进行windows本地动态调试<br><img src="https://img-blog.csdnimg.cn/20210205090150207.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">设置断点<br><img src="https://img-blog.csdnimg.cn/202102050902046.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">在locals里查看变量的值<br><img src="https://img-blog.csdnimg.cn/20210205090254631.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">关于IDA动态调试可看我的这篇文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50549897/article/details/113772269">逆向工程入门：IDAwindows本地动态调试，linux远程动态调试及虚拟机配置</a><br>写python脚本输出迷宫</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">0xffff</span>,<span class="number">0x83F7</span>,<span class="number">0xBBF7</span>,<span class="number">0xBB17</span>,<span class="number">0xBB57</span>,<span class="number">0xB857</span>,<span class="number">0xBF57</span>,<span class="number">0xBF17</span>,<span class="number">0xBFB7</span>,<span class="number">0xBFB7</span>,<span class="number">0x8611</span>,<span class="number">0xF7B5</span>,<span class="number">0xF7B5</span>,<span class="number">0x7B4</span>,<span class="number">0xFF87</span>,<span class="number">0xFFFF</span>]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">	i=<span class="built_in">bin</span>(i)</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210205090516545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">好了，迷宫到手了，显然入口是map[13][0],出口是map[13][15]，0可走，1不可走。让我们回到IDA，接下来要看看怎么玩<br>点开check函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">check</span><span class="params">(<span class="keyword">char</span> *Str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> Destination[<span class="number">4</span>]; <span class="comment">// [esp+1Ch] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v4[<span class="number">96</span>]; <span class="comment">// [esp+20h] [ebp-78h] BYREF</span></span><br><span class="line">  <span class="keyword">size_t</span> v5; <span class="comment">// [esp+80h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+84h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+88h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+8Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">  *(_DWORD *)Destination = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  <span class="built_in">strcpy</span>(Destination, Str);</span><br><span class="line">  v4[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(Destination, <span class="string">&quot;flag&#123;&quot;</span>) || Str[v5 - <span class="number">1</span>] != <span class="string">&#x27;&#125;&#x27;</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">13</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;<span class="comment">//表示起点为map[13][0]</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">5</span>; i &lt; (<span class="keyword">int</span>)(v5 - <span class="number">1</span>); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = Str[i];</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="string">&#x27;l&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v6;<span class="comment">//向右走</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v2 &gt; <span class="string">&#x27;l&#x27;</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">switch</span> ( v2 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;k&#x27;</span>:</span><br><span class="line">          --v7;<span class="comment">//向上走</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">          --v6;<span class="comment">//向左走</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">          ++v7;<span class="comment">//向下走</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">map</span>[<span class="number">16</span> * v7 + v6] )<span class="comment">//v6表示左右，v7表示上下</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用BFS走迷宫（代码如下）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">4</span>]=&#123;<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;k&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> mp[<span class="number">17</span>][<span class="number">17</span>];</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">17</span>][<span class="number">17</span>];</span><br><span class="line"><span class="keyword">int</span> startx=<span class="number">14</span>;<span class="keyword">int</span> starty=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> flagx=<span class="number">14</span>,flagy=<span class="number">16</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> x,y;</span><br><span class="line">	string step;</span><br><span class="line">&#125;;</span><br><span class="line">queue&lt;node&gt; Q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	node tmp;</span><br><span class="line">	tmp.x=startx,tmp.y=starty,tmp.step=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	Q.<span class="built_in">push</span>(tmp);</span><br><span class="line">	<span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		node now=Q.<span class="built_in">front</span>();</span><br><span class="line">		Q.<span class="built_in">pop</span>();</span><br><span class="line">		vis[now.x][now.y]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(now.x==flagx&amp;&amp;now.y==flagy)</span><br><span class="line">		&#123;</span><br><span class="line">			cout&lt;&lt;now.step&lt;&lt;endl;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;  </span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">4</span>;k++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> ux=now.x+dir[k][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">int</span> uy=now.y+dir[k][<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">if</span>(vis[ux][uy]==<span class="number">1</span>||mp[ux][uy]==<span class="number">1</span>||ux&lt;<span class="number">1</span>||ux&gt;<span class="number">16</span>||uy&lt;<span class="number">1</span>||uy&gt;<span class="number">16</span>)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">			node tmp;</span><br><span class="line">			tmp.x=ux,tmp.y=uy,tmp.step=now.step+s[k];</span><br><span class="line">			Q.<span class="built_in">push</span>(tmp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">16</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		string S;</span><br><span class="line">		cin&gt;&gt;S;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">16</span>;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(S[j<span class="number">-1</span>]==<span class="string">&#x27;0&#x27;</span>) mp[i][j]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span> mp[i][j]=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">bfs</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>输出得到<br><img src="https://img-blog.csdnimg.cn/20210611094606531.png#pic_center" alt="在这里插入图片描述"><br><strong>Get the flag!</strong> flag{llllkkkhhhkkkkkkkkklllljjjjllljjljjjjjjjlllkkkklljjjl}</p>
<p>走迷宫路径如下<br><img src="https://img-blog.csdnimg.cn/20210205092101623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="3-攻防世界新手区：NJUPT-CTF-2017-maze"><a href="#3-攻防世界新手区：NJUPT-CTF-2017-maze" class="headerlink" title="3.攻防世界新手区：NJUPT CTF 2017 maze"></a>3.攻防世界新手区：NJUPT CTF 2017 maze</h2><p>题目地址：<a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/task/answer?type=reverse&number=4&grade=0&id=5084&page=1">https://adworld.xctf.org.cn/task/answer?type=reverse&amp;number=4&amp;grade=0&amp;id=5084&amp;page=1</a><br>拖进IDA发现迷宫所在<br><img src="https://img-blog.csdnimg.cn/20210202194833506.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210202194845477.png#pic_center" alt="在这里插入图片描述"></p>
<p>分析main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v10[<span class="number">9</span>]; <span class="comment">// [rsp+4h] [rbp-24h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v10[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;<span class="comment">//迷宫从最左上角开始走</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;s1);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;s1) != <span class="number">24</span> || <span class="built_in">strncmp</span>(&amp;s1, <span class="string">&quot;nctf&#123;&quot;</span>, <span class="number">5uLL</span>) || *(&amp;byte_6010BF + <span class="number">24</span>) != <span class="string">&#x27;&#125;&#x27;</span> )<span class="comment">//如果是nctf&#123;开头且长度为24就进入下一步</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_22:<span class="comment">//要盯紧它，判断什么情况下会失败</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong flag!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = <span class="number">5LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;s1) - <span class="number">1</span> &gt; <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = *(&amp;s1 + v3);</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &gt; <span class="string">&#x27;N&#x27;</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v4 == <span class="string">&#x27;O&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v6 = sub_400650(v10);<span class="comment">//这里对v10进行了操作</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v4 == <span class="string">&#x27;o&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v6 = sub_400660(v10);<span class="comment">//这里对v10进行了操作</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v4 == <span class="string">&#x27;.&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v6 = sub_400670(&amp;v9);<span class="comment">//这里对&amp;v9进行了操作</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v4 == <span class="string">&#x27;0&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v6 = sub_400680(&amp;v9);<span class="comment">//这里对&amp;v9进行了操作</span></span><br><span class="line">LABEL_14:</span><br><span class="line">          v5 = v6;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">LABEL_15:</span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> __int8)sub_400690((__int64)asc_601060, v10[<span class="number">0</span>], v9) )<span class="comment">//这里要关注障碍检测，还有非常重要的东西</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">      <span class="keyword">if</span> ( ++v3 &gt;= <span class="built_in">strlen</span>(&amp;s1) - <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">LABEL_20:</span><br><span class="line">        v7 = <span class="string">&quot;Wrong flag!&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( asc_601060[<span class="number">8</span> * v9 + v10[<span class="number">0</span>]] != <span class="string">&#x27;#&#x27;</span> )<span class="comment">//终点为#</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">  v7 = <span class="string">&quot;Congratulations!&quot;</span>;</span><br><span class="line">LABEL_21:</span><br><span class="line">  <span class="built_in">puts</span>(v7);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由伪代码可见，这是个8*8的迷宫，有四个判断条件，分别进入了四个函数。<br>‘O’,’o’,’0’,’.’这四个字符分别控制不同方向<br>O左，o右，0下，.上（稍后会说怎么判断）<br>四个方向函数如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __fastcall <span class="title">sub_400650</span><span class="params">(_DWORD *a1)</span><span class="comment">//O</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = (*a1)--;<span class="comment">//向左一步</span></span><br><span class="line">  <span class="keyword">return</span> v1 &gt; <span class="number">0</span>;<span class="comment">//防止越界</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __fastcall <span class="title">sub_400660</span><span class="params">(<span class="keyword">int</span> *a1)</span><span class="comment">//o</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = *a1 + <span class="number">1</span>;<span class="comment">//向右一步</span></span><br><span class="line">  *a1 = v1;</span><br><span class="line">  <span class="keyword">return</span> v1 &lt; <span class="number">8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __fastcall <span class="title">sub_400670</span><span class="params">(_DWORD *a1)</span><span class="comment">//.</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = (*a1)--;<span class="comment">//向上一步</span></span><br><span class="line">  <span class="keyword">return</span> v1 &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __fastcall <span class="title">sub_400680</span><span class="params">(<span class="keyword">int</span> *a1)</span><span class="comment">//0</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = *a1 + <span class="number">1</span>;</span><br><span class="line">  *a1 = v1;<span class="comment">//向下一步</span></span><br><span class="line">  <span class="keyword">return</span> v1 &lt; <span class="number">8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可是怎么分辨v9和v10各自控制的是上下还是左右呢？<br>点开sub_400690函数，看到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_400690</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//a1是数组的首地址，a2是v10,a3是v9</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = *(<span class="keyword">unsigned</span> __int8 *)(a1 + a2 + <span class="number">8LL</span> * a3);<span class="comment">//a3乘以8表明v10在二维数组中表示上下</span></span><br><span class="line">  LOBYTE(result) = (_DWORD)result == <span class="string">&#x27; &#x27;</span> || (_DWORD)result == <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从这里我们得知v10表示行，就是控制上下。v9表示列，就是控制左右。<br>而且只有‘ ’ 和#可以走，否则返回return 0。’*’是迷宫的墙。<br>写代码生成迷宫，0可走，X为墙。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s[]=<span class="string">&quot;  *******   *  **** * ****  * ***  *#  *** *** ***     *********&quot;</span>;</span><br><span class="line">	<span class="keyword">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">8</span>;j++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(s[i*<span class="number">8</span>+j]==<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;0&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(s[i*<span class="number">8</span>+j]==<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;X&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">				<span class="keyword">else</span> </span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;#&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		cout&lt;&lt;endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210202214138794.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">走迷宫得到flag为     <strong>nctf{o0oo00O000oooo…OO}</strong></p>
<h2 id="4-BUUCTF：不一样的flag"><a href="#4-BUUCTF：不一样的flag" class="headerlink" title="4.BUUCTF：不一样的flag"></a>4.BUUCTF：不一样的flag</h2><p>题目地址：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a><br>拖进IDA查看main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">29</span>]; <span class="comment">// [esp+17h] [ebp-35h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+34h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+38h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+3Ch] [ebp-10h]</span></span><br><span class="line">  _BYTE v7[<span class="number">12</span>]; <span class="comment">// [esp+40h] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;*11110100001010000101111#&quot;</span>);<span class="comment">//这就是迷宫</span></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;you can choose one action to execute&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1 up&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2 down&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3 left&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;4 right\n:&quot;</span>);<span class="comment">//控制方向</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v5);</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++*(_DWORD *)&amp;v3[<span class="number">25</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v5 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v5 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        --v4;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 != <span class="number">4</span> )</span><br><span class="line">LABEL_13:</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        ++v4;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v5 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      --*(_DWORD *)&amp;v3[<span class="number">25</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *(<span class="keyword">int</span> *)&amp;v3[<span class="number">4</span> * i + <span class="number">25</span>] &lt; <span class="number">0</span> || *(<span class="keyword">int</span> *)&amp;v3[<span class="number">4</span> * i + <span class="number">25</span>] &gt; <span class="number">4</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7[<span class="number">5</span> * *(_DWORD *)&amp;v3[<span class="number">25</span>] - <span class="number">41</span> + v4] == <span class="string">&#x27;1&#x27;</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);<span class="comment">//是个5*5的迷宫且1为墙</span></span><br><span class="line">    <span class="keyword">if</span> ( v7[<span class="number">5</span> * *(_DWORD *)&amp;v3[<span class="number">25</span>] - <span class="number">41</span> + v4] == <span class="string">&#x27;#&#x27;</span> )</span><br><span class="line">    &#123;<span class="comment">//‘#’是迷宫终点</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;\nok, the order you enter is the flag!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一目了然，显然是一道迷宫题。<br>1，2，3，4分别控制上下左右</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s[]=<span class="string">&quot;*11110100001010000101111#&quot;</span>;</span><br><span class="line">	<span class="keyword">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">5</span>;j++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(s[i*<span class="number">5</span>+j]==<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;0&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(s[i*<span class="number">5</span>+j]==<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">				cout&lt;&lt;<span class="string">&quot;X&quot;</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">				<span class="keyword">else</span> </span><br><span class="line">				cout&lt;&lt;s[i*<span class="number">5</span>+j]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		cout&lt;&lt;endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>走迷宫<br><img src="https://img-blog.csdnimg.cn/20210203131010449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MDU0OTg5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><strong>Get the flag!</strong>:   flag{222441144222}</p>
<h1 id="三，总结"><a href="#三，总结" class="headerlink" title="三，总结"></a>三，总结</h1><p> 希望新接触reverse的读者能通过CTF的迷宫题产生对CTF的兴趣。</p>
<h1 id="本人其它文章链接"><a href="#本人其它文章链接" class="headerlink" title="本人其它文章链接"></a>本人其它文章链接</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50549897/article/details/113523762">BUUCTF reverse：[GXYCTF2019]luck_guy,findit,简单注册器题解</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50549897/article/details/112099578">封神台靶场尤里的复仇I第一第二第五第六第七章解题思路(持续更新）</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50549897/article/details/113743550">ctfhub:网鼎杯第一场2018 reverse-beijing题解</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50549897/article/details/113772269">逆向工程入门：IDAwindows本地动态调试，linux远程动态调试及虚拟机配置</a></p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p><h4>Copyright © 2020 | Author: June | Theme By <a class="theme-author" target="_blank" rel="noopener" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">Page Views: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">Unique Visitors: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="NOsswOncKgc8HOxqo9oxIWlX-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="z1FihjWEbS8uIfUQdmCtK7zz">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
